# 1. windowToolboxMalwareRemoval
[![made-with-powershell](https://img.shields.io/badge/PowerShell-1f425f?logo=Powershell)](https://microsoft.com/PowerShell)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
![Repo:Size](https://img.shields.io/github/languages/code-size/pabumake/windowToolboxMalware-Removal)

wTM-Removal searches and removes malicious files contained within windowstoolbox.

TLDR:
Please report this bad Repo: https://github.com/windowtoolbox/under_observation
## 1.1 Contents

- [1. windowToolboxMalwareRemoval](#1-windowtoolboxmalwareremoval)
  - [1.1 Contents](#11-contents)
- [2. Usage](#2-usage)
- [3. Combined Investigation Report from SemperVideo Discord Community](#3-combined-investigation-report-from-sempervideo-discord-community)
  - [3.1 Deobfuscated](#31-deobfuscated)
  - [3.2 Are you affected ?](#32-are-you-affected-)
  - [3.3 Why are only "en-" Users affected ?](#33-why-are-only-en--users-affected-)
- [4. Thanks to](#4-thanks-to)

# 2. Usage

1. Start wTM-Removal.cmd as Administrator (wTM-Removal.ps1 needs to be in same Folder)
2. Accept the UAC Prompt for Powershell
3. On Removal request answer with Y/y -> Enter
4. Reboot System & Run Windows Troubleshooting for Windows Updates


# 3. Combined Investigation Report from SemperVideo Discord Community

Malicious thing this discord is about: https://github.com/windowtoolbox/powershell-windows-toolbox <br>
[Wayback Archive Link](https://web.archive.org/web/20220401004833/https://github.com/windowtoolbox/powershell-windows-toolbox) before the repository was changed.

Second Account used : https://github.com/alexrybak0444 <br>
This might be the original project: https://github.com/WinTweakers/WindowsToolbox <br>

Deleted issue in the original repository:<br>
[Wayback Archive Link](https://web.archive.org/web/20220409165432/https://github.com/windowtoolbox/powershell-windows-toolbox/issues/32) before the repository was changed.

## 3.1 Deobfuscated
All thanks to @ZerGo0 <br>
Stage 1: (@LinuxUserGD) <br>
https://gist.github.com/ZerGo0/aa0984800fd6da0a9d9e7842a0dc3645 <br>
[Stage 1: Explained](https://gist.github.com/ZerGo0/aa0984800fd6da0a9d9e7842a0dc3645?permalink_comment_id=4127278#gistcomment-4127278)

Stage 2: <br>
https://gist.github.com/ZerGo0/690175a1163bd4747d825491810c6ebb <br>
[Stage 2: Explained](https://gist.github.com/ZerGo0/690175a1163bd4747d825491810c6ebb?permalink_comment_id=4127295#gistcomment-4127295)<br>

Stage 3:
https://gist.github.com/ZerGo0/ce1d2786cdb5ecca248f309a98b1d987 <br>
     [Stage 3: Explained](https://gist.github.com/ZerGo0/ce1d2786cdb5ecca248f309a98b1d987?permalink_comment_id=4127311#gistcomment-4127311)

Showcase 1 (Gets stuck at Curl) <br>
https://app.any.run/tasks/40c113ab-7908-4979-8810-8733fd67bf3a/

Showcase 2 / (Progressing the Script by hand) <br>
https://app.any.run/tasks/b6f0d354-bce5-401a-b422-08d262b2be82/ 

## 3.2 Are you affected ?
To check if you are infected: <br>
Open PowerShell as admin
```
Get-WinSystemLocale
```

if "Name" start with "en-" <br>
Check for the rest, if not, then you are most likely safe. <br>

Does this exist?
```
C:\systemfile\
C:\Windows\security\pywinvera
C:\Windows\security\pywinveraa
```

Or do these Task exist in Task Scheduler
```
Microsoft\Windows\AppID\VerifiedCert
Microsoft\Windows\Application Experience\Maintenance
Microsoft\Windows\Services\CertPathCheck
Microsoft\Windows\Services\CertPathw
Microsoft\Windows\Servicing\ComponentCleanup
Microsoft\Windows\Servicing\ServiceCleanup
Microsoft\Windows\Shell\ObjectTask
Microsoft\Windows\Clip\ServiceCleanup
```

Then you are affected!

## 3.3 Why are only "en-" Users affected ?
There is a check in Stage 3, where the bad stuff happens, here it checks for the SystemLocale if it is not "en-" it kills the cmd.exe, <br>
Which stops everything else (look at the first showcase linked above). <br>
On the right side you see the Processes, here if it reaches 560 cmd.exe it opens PowerShell with the check. <br>

![firefox_2022-04-10_17-37-14](https://user-images.githubusercontent.com/13680959/162627368-eede9728-ff01-4e39-9635-ab7276ff7438.png)


The check fails (for us Germans, for example) and it kills itself. <br>
For others, the script just keeps going. <br>

# 4. Thanks to
Zergo0, LinuxUserGD, OptionalM and Zuescho for Investigative Report <br>
luzea,Harromann,Zuescho,XplLiciT,Cirno,Janmm14 for Bugfixes, Testing and QoS improvements <br>
